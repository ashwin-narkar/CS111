/*NAME: Ashwin NarkarEMAIL: ashwin.narkar@gmail.comID: 204585474*/#include <stdio.h>#include <stdlib.h> #include <getopt.h>#include <signal.h>#include <errno.h>#include <string.h>#include <unistd.h>#include "fcntl.h"#define UNUSED(expr) do { (void)(expr); } while (0)int dump_core_flag;void createSegFault() {	char* c = NULL;	*c = 1;}void catchError(int signum) {	if (dump_core_flag != 1) {		fprintf(stderr,"Segmentation Fault! Signal %d\n",signum);		exit(4);	}}int main(int argc, char* argv[]) {	int input_flag;	int output_flag;	dump_core_flag=0;	input_flag = 0;	output_flag = 0;	int input_file;	int output_file;	char* inputFilename;	char* outputFilename;	struct option long_options[] = {		{"input",required_argument,0,'i'},		{"output",required_argument,0,'o'},		{"segfault",no_argument,0,'s'},		{"catch",no_argument,0,'c'},		{"dump-core",no_argument,0,'d'},		{NULL,0,NULL,0}	};	int index =0;	int c = 0;	while (c != -1){		opterr= 0;		c = getopt_long(argc,argv,"",long_options,&index);				switch(c) {			case 'i':				input_flag = 1;				inputFilename = optarg;				break;			case 'o':				output_flag = 1;				outputFilename = optarg;				break;			case 's':								if (strcmp(argv[optind-1],"--segfault")) {					printf("Invalid option %s, did you mean --segfault?\n",argv[optind-1]);					exit(1);				}				createSegFault();				break;			case 'c':								signal(SIGSEGV,catchError);				if (strcmp(argv[optind-1],"--catch")) {					printf("Invalid option %s, did you mean --catch?\n",argv[optind-1]);					exit(1);				}				break;			case 'd':				signal(SIGSEGV,SIG_DFL);				break;			case 0:				printf("%s\n",argv[optind-1]);				break;			case '?':				if (optopt == 'i') {					if (strcmp(argv[optind-1],"--input")) {						printf("Invalid option %s, did you mean --input=file?\n",argv[optind-1]);						exit(1);					}					fprintf(stderr,"Missing argument for --input\n");					exit(1);				}				else if (optopt == 'o') {					if (strcmp(argv[optind-1],"--output")) {						printf("Invalid option %s, did you mean --output=file?\n",argv[optind-1]);						exit(1);					}					fprintf(stderr,"Missing argument for --output\n");					exit(1);				}				else if (optopt==0) {					fprintf(stderr,"Invalid long option %s\n",argv[optind-1]);					exit(1);				}				else {					fprintf(stderr,"%c\n",optopt);					fprintf(stderr,"Invalid option %s\n",argv[optind-1]);					exit(1);				}						}			}	char buff[1];	if (input_flag && !output_flag){		input_file = open(inputFilename,O_RDONLY);		if (input_file < 0) {			fprintf(stderr,"Error: %s\n", strerror(errno));			exit(2);		}		if (input_file >= 0) {			close(0);			dup(input_file);			close(input_file);		}	}	else if(!input_flag && output_flag) {		output_file = creat(outputFilename,0666);		if (output_file <= 0) {			fprintf(stderr,"Error: %s\n", strerror(errno));			exit(3);		}				if (output_file > 0) {			close(1);			dup(output_file);			close(output_file);		}	}	else if(input_flag && output_flag) {		input_file = open(inputFilename,O_RDONLY);		if (input_file < 0) {			fprintf(stderr,"Error: %s\n", strerror(errno));			exit(2);		}		output_file = creat(outputFilename,0666);		if (output_file <= 0) {			fprintf(stderr,"Error: %s\n", strerror(errno));			exit(3);		}				if (input_file >= 0) {			close(0);			dup(input_file);			close(input_file);		}		if (output_file > 0) {			close(1);			dup(output_file);			close(output_file);		}	}		while(read(0,buff,sizeof(buff))>0) {			write(1,buff,sizeof(buff));		}		exit(0);}